"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
class Logger {
    constructor(options) {
        this.options = {
            output: options.output || "stderr",
            verbosity: options.verbosity || "info",
            callback: options.callback || undefined,
        };
        this.resetLog();
    }
    setRequestMethod(method) {
        this.request.request.method = method;
    }
    setRequestHeaders(headers) {
        this.request.request.headers = headers;
    }
    setRequestBody(body) {
        this.request.request.body = body;
    }
    setResponseHeaders(headers) {
        this.request.response.headers = headers;
    }
    setResponseBody(body) {
        this.request.response.body = body;
    }
    setResponseStatus(status) {
        this.request.response.status = status;
    }
    setRequestIsMutation() {
        this.request.meta.is_mutation = true;
    }
    setStartTs() {
        this.start_ts = new Date();
    }
    setEndTs() {
        this.end_ts = new Date();
    }
    calculateElapsedMs() {
        if (!this.end_ts || !this.start_ts) {
            return;
        }
        // @ts-ignore This is okay
        const ms = this.end_ts - this.start_ts;
        this.request.meta.elapsed_ms = ms;
    }
    log() {
        let output = "";
        this.calculateElapsedMs();
        if (this.options.verbosity === "warning") {
            output = this.getWarningMessage();
        }
        else if (this.options.verbosity === "debug") {
            output = this.getDebugMessage();
        }
        else {
            output = this.getInfoMessage();
        }
        if (this.options.output === "stdout") {
            process.stdout.write(output);
        }
        if (this.options.output === "stderr") {
            process.stderr.write(output);
        }
        if (this.options.callback) {
            this.options.callback(this.request);
        }
        this.resetLog();
    }
    getDebugMessage() {
        return `\n${JSON.stringify(this.request.request)}\n`;
    }
    getInfoMessage() {
        return `\n${JSON.stringify(this.request)}\n`;
    }
    getWarningMessage() {
        return `\n${JSON.stringify(this.request.response)}\n`;
    }
    resetLog() {
        const default_meta = {
            is_mutation: false,
            elapsed_ms: undefined,
        };
        this.request = {
            request: { method: undefined, headers: undefined, body: undefined },
            response: { headers: undefined, body: undefined, status: undefined },
            meta: default_meta,
        };
        this.start_ts = undefined;
        this.end_ts = undefined;
    }
}
exports.Logger = Logger;
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibG9nZ2VyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vc3JjL2xpYi9sb2dnZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7QUF1QkEsTUFBYSxNQUFNO0lBTWpCLFlBQVksT0FBbUI7UUFDN0IsSUFBSSxDQUFDLE9BQU8sR0FBRztZQUNiLE1BQU0sRUFBRSxPQUFPLENBQUMsTUFBTSxJQUFJLFFBQVE7WUFDbEMsU0FBUyxFQUFFLE9BQU8sQ0FBQyxTQUFTLElBQUksTUFBTTtZQUN0QyxRQUFRLEVBQUUsT0FBTyxDQUFDLFFBQVEsSUFBSSxTQUFTO1NBQ3hDLENBQUM7UUFDRixJQUFJLENBQUMsUUFBUSxFQUFFLENBQUM7SUFDbEIsQ0FBQztJQUVNLGdCQUFnQixDQUFDLE1BQWM7UUFDcEMsSUFBSSxDQUFDLE9BQVEsQ0FBQyxPQUFRLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUN6QyxDQUFDO0lBRU0saUJBQWlCLENBQUMsT0FBWTtRQUNuQyxJQUFJLENBQUMsT0FBUSxDQUFDLE9BQVEsQ0FBQyxPQUFPLEdBQUcsT0FBTyxDQUFDO0lBQzNDLENBQUM7SUFFTSxjQUFjLENBQUMsSUFBUztRQUM3QixJQUFJLENBQUMsT0FBUSxDQUFDLE9BQVEsQ0FBQyxJQUFJLEdBQUcsSUFBSSxDQUFDO0lBQ3JDLENBQUM7SUFFTSxrQkFBa0IsQ0FBQyxPQUFZO1FBQ3BDLElBQUksQ0FBQyxPQUFRLENBQUMsUUFBUyxDQUFDLE9BQU8sR0FBRyxPQUFPLENBQUM7SUFDNUMsQ0FBQztJQUVNLGVBQWUsQ0FBQyxJQUFTO1FBQzlCLElBQUksQ0FBQyxPQUFRLENBQUMsUUFBUyxDQUFDLElBQUksR0FBRyxJQUFJLENBQUM7SUFDdEMsQ0FBQztJQUVNLGlCQUFpQixDQUFDLE1BQVc7UUFDbEMsSUFBSSxDQUFDLE9BQVEsQ0FBQyxRQUFTLENBQUMsTUFBTSxHQUFHLE1BQU0sQ0FBQztJQUMxQyxDQUFDO0lBRU0sb0JBQW9CO1FBQ3pCLElBQUksQ0FB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